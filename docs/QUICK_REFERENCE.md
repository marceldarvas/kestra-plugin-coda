# Coda API Quick Reference

## Authentication
```
Authorization: Bearer YOUR_API_KEY
```

Get your API key: Account Settings ‚Üí Developer/API Settings

---

## Base URL
```
https://coda.io/apis/v1/
```

---

## Common Endpoints

### Tables

| Operation | Method | Endpoint |
|-----------|--------|----------|
| List tables | GET | `/docs/{docId}/tables` |
| Get table | GET | `/docs/{docId}/tables/{tableId}` |

### Columns

| Operation | Method | Endpoint |
|-----------|--------|----------|
| List columns | GET | `/docs/{docId}/tables/{tableId}/columns` |
| Get column | GET | `/docs/{docId}/tables/{tableId}/columns/{columnId}` |

### Rows

| Operation | Method | Endpoint |
|-----------|--------|----------|
| List rows | GET | `/docs/{docId}/tables/{tableId}/rows` |
| Get row | GET | `/docs/{docId}/tables/{tableId}/rows/{rowId}` |
| Insert rows | POST | `/docs/{docId}/tables/{tableId}/rows` |
| Update row | PUT | `/docs/{docId}/tables/{tableId}/rows/{rowId}` |
| Upsert rows | POST | `/docs/{docId}/tables/{tableId}/rows/upsert` |
| Delete row | DELETE | `/docs/{docId}/tables/{tableId}/rows/{rowId}` |

### Automations

| Operation | Method | Endpoint |
|-----------|--------|----------|
| Trigger webhook | POST | `{webhookUrl}` (generated by Coda) |

---

## Request Examples

### List Tables
```bash
curl -X GET "https://coda.io/apis/v1/docs/{docId}/tables" \
  -H "Authorization: Bearer YOUR_API_KEY"
```

### List Columns
```bash
curl -X GET "https://coda.io/apis/v1/docs/{docId}/tables/{tableId}/columns" \
  -H "Authorization: Bearer YOUR_API_KEY"
```

### Insert Row
```bash
curl -X POST "https://coda.io/apis/v1/docs/{docId}/tables/{tableId}/rows" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "rows": [{
      "cells": [
        {"column": "c-columnId1", "value": "Value 1"},
        {"column": "c-columnId2", "value": "Value 2"}
      ]
    }]
  }'
```

### Upsert Row
```bash
curl -X POST "https://coda.io/apis/v1/docs/{docId}/tables/{tableId}/rows/upsert" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "rows": [{
      "cells": [
        {"column": "c-keyColumn", "value": "UniqueKey"},
        {"column": "c-dataColumn", "value": "New Data"}
      ]
    }],
    "keyColumns": ["c-keyColumn"]
  }'
```

### Trigger Webhook Automation
```bash
curl -X POST "{webhookUrl}" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "field1": "value1",
    "field2": "value2"
  }'
```

---

## Column Types

| Type | Description |
|------|-------------|
| `text` | Text values |
| `number` | Numeric values |
| `date` | Date values |
| `time` | Time values |
| `dateTime` | Date and time values |
| `select` | Single choice select list |
| `multiSelect` | Multiple choice select list |
| `people` | Coda user references |
| `lookup` | References to other tables |
| `button` | Action buttons |
| `image` | Image attachments |
| `file` | File attachments |
| `link` | URL links |
| `canvas` | Rich text/embedded content |

---

## Common Query Parameters

### Pagination
- `limit`: Number of results (default: 25, max: 500)
- `pageToken`: Token for next page

### Filtering
- `query`: Filter expression (limited support)
- `sortBy`: Column to sort by
- `visibleOnly`: Return only visible rows (default: false)

---

## Response Codes

| Code | Meaning |
|------|---------|
| 200 | Success |
| 201 | Created |
| 202 | Accepted (async operation) |
| 400 | Bad Request |
| 401 | Unauthorized (invalid API token) |
| 403 | Forbidden |
| 404 | Not Found |
| 429 | Rate Limit Exceeded |
| 500 | Server Error |

---

## Important Notes

### ‚úÖ Supported Operations
- Read tables, columns, and rows
- Insert, update, upsert, and delete rows
- Trigger automations via webhooks
- Pagination for large datasets

### ‚ùå Limitations
- **Cannot create tables** via API
- **Cannot access comments** via API
- **Views are read-only** (use base tables for modifications)
- **Rate limits apply** (not publicly documented)

### üîë Best Practices
1. Always use IDs (not names) for resources
2. Use base tables (not views) for insert/update/delete
3. Implement retry logic with exponential backoff
4. Cache table and column metadata
5. Validate data types before sending
6. Use pagination for large result sets
7. Store API tokens securely

---

## Setting Up Webhook Automation

1. Open Coda doc ‚Üí three-dot menu (‚ãÆ) ‚Üí "Doc settings"
2. Go to "Automations" ‚Üí "+ Add rule"
3. **When**: Select "Webhook invoked"
4. Copy the generated webhook URL
5. **Then**: Define actions (add row, send notification, etc.)
6. Use Bearer token authentication when calling the webhook

### Access Webhook Data
- Payload is available as **"Step 1 Result"**
- Extract values: `ParseJSON([Step 1 Result], "key")`
- Iterate arrays: Use ForEach with `ParseJSON([Step 1 Result], "items")`

---

## Java Code Snippets

### Initialize Client
```java
OkHttpClient client = new OkHttpClient();
String apiToken = "YOUR_API_KEY";
```

### Make GET Request
```java
Request request = new Request.Builder()
    .url("https://coda.io/apis/v1/docs/" + docId + "/tables")
    .addHeader("Authorization", "Bearer " + apiToken)
    .build();

Response response = client.newCall(request).execute();
String responseBody = response.body().string();
```

### Make POST Request
```java
String json = "{\"rows\":[{\"cells\":[{\"column\":\"c-abc\",\"value\":\"Test\"}]}]}";

RequestBody body = RequestBody.create(
    json,
    MediaType.get("application/json; charset=utf-8")
);

Request request = new Request.Builder()
    .url("https://coda.io/apis/v1/docs/" + docId + "/tables/" + tableId + "/rows")
    .post(body)
    .addHeader("Authorization", "Bearer " + apiToken)
    .addHeader("Content-Type", "application/json")
    .build();

Response response = client.newCall(request).execute();
```

---

## Resources

- **API Docs**: [https://coda.io/developers](https://coda.io/developers)
- **Getting Started**: [https://coda.io/@oleg/getting-started-guide-coda-api](https://coda.io/@oleg/getting-started-guide-coda-api)
- **Postman Collection**: [https://www.postman.com/codaio/coda-workspace/](https://www.postman.com/codaio/coda-workspace/)
- **Community**: [https://community.coda.io/](https://community.coda.io/)

---

For detailed information, see [CODA_API_GUIDE.md](./CODA_API_GUIDE.md)
